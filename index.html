<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>상품관리 AJAX 실습</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>

  <style>
    body { background-color:#f8f9fa; }
    h2 { text-align:center; margin:20px 0; }
    #div_list div{
      padding:6px 8px;
      border-bottom:1px solid #dee2e6;
      font-size:0.95rem;
    }
    #div_list div:nth-child(odd){ background-color:#fff; }
    #div_list div:nth-child(even){ background-color:#f1f3f5; }
  </style>
</head>
<body>
  <div class="container py-4">
    <h2>상품관리 (AJAX + XMLHttpRequest)</h2>

    <div class="d-flex justify-content-between align-items-center mb-3">
      <button id="btn_list" class="btn btn-primary">목록 보기</button>

      <div class="d-flex gap-2">
        <button
          id="btn_add_open"
          type="button"
          class="btn btn-success"
          data-bs-toggle="modal"
          data-bs-target="#productModal"
        >
          상품 추가
        </button>
        <button
          id="btn_update_open"
          type="button"
          class="btn btn-warning"
          data-bs-toggle="modal"
          data-bs-target="#productModal"
        >
          상품 수정
        </button>
      </div>
    </div>

    <div id="div_list" class="mb-4 border rounded p-3 bg-white">
      목록 출력 영역
    </div>

    <div class="row g-2 align-items-center">
      <div class="col-auto">
        <label for="input_delete_id" class="col-form-label">삭제할 ID</label>
      </div>
      <div class="col-auto">
        <input type="text" id="input_delete_id" class="form-control" style="width:120px;">
      </div>
      <div class="col-auto">
        <button id="btn_delete" class="btn btn-danger">삭제하기</button>
      </div>
    </div>
  </div>

  <div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="modalTitle">상품 추가</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="modal_id" class="form-label">ID</label>
            <input type="text" class="form-control" id="modal_id" placeholder="예: 11">
          </div>
          <div class="mb-3">
            <label for="modal_name" class="form-label">품명</label>
            <input type="text" class="form-control" id="modal_name" placeholder="상품 이름">
          </div>
          <div class="mb-3">
            <label for="modal_price" class="form-label">가격</label>
            <input type="number" class="form-control" id="modal_price" placeholder="가격(숫자)">
          </div>
          <div class="mb-3">
            <label for="modal_amount" class="form-label">수량</label>
            <input type="number" class="form-control" id="modal_amount" placeholder="수량(숫자)">
          </div>
          <div class="mb-3">
            <label for="modal_state" class="form-label">상태</label>
            <input type="text" class="form-control" id="modal_state" placeholder="예: 정상 판매중">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <button type="button" class="btn btn-primary" id="modalSaveBtn">저장</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const BASE_URL = "https://6915407184e8bd126af93b79.mockapi.io/endpoint/products";
    let modalMode = "add";

    $(function () {
    
      $("#btn_list").click(function () {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", BASE_URL);
        xhr.send();
        xhr.onload = () => {
          if (xhr.status === 200) {
            const res = JSON.parse(xhr.response);
            $("#div_list").html("");
            res.forEach(each => {
              $("#div_list").append(
                `<div>${each.id} : ${each.name} | ${each.price}원 | 수량:${each.amount} | 상태:${each.state}</div>`
              );
            });
          } else {
            console.log(xhr.status, xhr.statusText);
          }
        };
      });


      $("#btn_add_open").click(function () {
        modalMode = "add";
        $("#modalTitle").text("상품 추가");
        $("#modal_id").prop("readonly", false);
        $("#modal_id").val("");
        $("#modal_name").val("");
        $("#modal_price").val("");
        $("#modal_amount").val("");
        $("#modal_state").val("정상 판매중");
      });


      $("#btn_update_open").click(function () {
        modalMode = "edit";
        $("#modalTitle").text("상품 수정");
        $("#modal_id").prop("readonly", false);
        $("#modal_id").val("");
        $("#modal_name").val("");
        $("#modal_price").val("");
        $("#modal_amount").val("");
        $("#modal_state").val("");
      });

      $("#modalSaveBtn").click(function () {
        const id     = $("#modal_id").val().trim();
        const name   = $("#modal_name").val().trim();
        const price  = Number($("#modal_price").val());
        const amount = Number($("#modal_amount").val());
        const state  = $("#modal_state").val().trim();

        if (!id || !name) {
          alert("ID와 품명은 필수입니다.");
          return;
        }

        const data = { id, name, price, amount, state };
        const xhr = new XMLHttpRequest();

        if (modalMode === "add") {
          xhr.open("POST", BASE_URL);
        } else {
          xhr.open("PUT", BASE_URL + "/" + id);
        }

        xhr.setRequestHeader("content-type", "application/json");
        xhr.send(JSON.stringify(data));
        xhr.onload = () => {
          if (modalMode === "add" && xhr.status === 201) {
            alert("상품이 추가되었습니다.");
            $("#btn_list").click();
          } else if (modalMode === "edit" && xhr.status === 200) {
            alert("상품이 수정되었습니다.");
            $("#btn_list").click();
          } else {
            console.log(xhr.status, xhr.statusText);
            alert("요청 중 오류가 발생했습니다.");
          }
        };
      });


      $("#btn_delete").click(function () {
        const id = $("#input_delete_id").val().trim();
        if (!id) {
          alert("삭제할 ID를 입력하세요.");
          return;
        }

        const xhr = new XMLHttpRequest();
        xhr.open("DELETE", BASE_URL + "/" + id);
        xhr.send();
        xhr.onload = () => {
          if (xhr.status === 200) {
            alert("상품이 삭제되었습니다.");
            $("#btn_list").click();
          } else {
            console.log(xhr.status, xhr.statusText);
            alert("삭제 중 오류가 발생했습니다.");
          }
        };
      });
    });
  </script>
</body>
</html>